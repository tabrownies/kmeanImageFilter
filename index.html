<!DOCTYPE html>
<html>

<head>
    <link href="hex.css" type="text/css" rel="stylesheet">
</head>

<body>
    <div id="choosers">

    </div>

    <!-- <img id="color" src="taxi.jpeg" /> -->
    <img id='result' />
    <a download id="download-link">Download</a>
    <input type="file" id="img" name="img" accept="image/*" onchange="process(this)">
    <script src="https://www.lactame.com/lib/image-js/0.21.2/image.min.js"></script>
    <script src="kmeans.js"></script>
    <script src="image.js"></script>
    <script src="hex.js"></script>
    <script>
        let chooserContainer = document.querySelector('#choosers');
        let chooserControls = [];
        console.log('script is running')
        async function process(input) {
            // reset the chooserContainer
            chooserContainer.innerHTML = '';
            let reader = new FileReader();
            reader.onload = async function (e) {
                let imageData = await IJS.Image.load(e.target.result)
                let image = new Image(imageData, 3)

                imageData = image.export();
                // use new image url for both the image and the link for the download
                document.getElementById('result').src = imageData.toDataURL();
                document.getElementById('download-link').href = imageData.toDataURL();
                
                // for each color create a way to change the hexvalue
                for(let color of image.clusterColors){
                    let chooser = createChooserHTML()
                    chooserContainer.appendChild(chooser);
                    chooserControls.push(new ColorChooser(chooser, color[0],color[1],color[2]));
                }

            }
            reader.readAsDataURL(input.files[0]);
        }
    </script>

</body>

</html>